---
title: 'Lint规范和配置'
date: 2022-01-10
tag:
  - 前端标准化
categories:
  - 前端标准化
---

## Eslint

1. 安装 eslint 依赖

```shell
npm i --save-dev babel-eslint eslint eslint-plugin-vue eslint-plugin-prettier eslint-config-prettier @typescript-eslint/eslint-plugin @typescript-eslint/parser
```

2. package.json 中的 scripts 里添加

```json
"lint:js": "eslint --fix --ext \".js,.vue,.ts\" src",
```

3. 项目根目录添加 .eslintignore 文件，里面表示不需要检验的目录

```plain
build/*.js
src/assets
public
dist

# 类型
typings

# 第三方库
wxcomponents
qqmap-wx-jssdk1.2
tki-qrcode
```

4. 项目根目录添加 .eslintrc.js 文件，添加对应的规则

```js
module.exports = {
  root: true,
  parser: 'vue-eslint-parser',
  parserOptions: {
    ecmaVersion: 2020,
    sourceType: 'module',
    parser: '@typescript-eslint/parser',
    ecmaFeatures: {
      jsx: true,
      globalReturn: true,
      impliedStrict: false,
      experimentalObjectRestSpread: true, //启用对对象的扩展
    },
  },
  env: {
    browser: true,
    es2020: true,
    node: true,
  },
  plugins: ['prettier', '@typescript-eslint'],
  extends: [
    'eslint:recommended',
    'plugin:vue/recommended',
    'plugin:@typescript-eslint/eslint-recommended',
    'eslint-config-prettier',
  ],
  globals: {
    uni: true,
    wx: true,
    getCurrentPages: true,
    WechatMiniprogram: true,
    getApp: true,
    UniApp: true,
  },
  rules: {
    'no-console': process.env.NODE_ENV === 'production' ? 'warn' : 'off',
    'no-debugger': process.env.NODE_ENV === 'production' ? 2 : 0,
    // 以下关闭 新项目需打开
    'no-empty': 0,
    '@typescript-eslint/no-explicit-any': 0,
    'vue/attribute-hyphenation': 0,
    'prefer-rest-params': 0,
    'vue/component-definition-name-casing': 0, // 驼峰法命名规则
    'no-undef': 0,
    'no-unused-vars': 0,
    'no-useless-escape': 0,
  },
}
```

- vue/component-definition-name-casing

Define a style for component definition name casing for consistency purposes.

此项 fix 会自动修改命名，防止出错，关闭

## Stylelint

1. 安装 stylelint 依赖

```shell
npm install --save-dev stylelint stylelint-scss stylelint-config-standard stylelint-config-prettier stylelint-order stylelint-config-recess-order
```

**stylelint-scss**

> scss 拓展，增加支持 scss 语法

**stylelint-config-standard**

> 作用：配置 Stylelint 规则。
> 官方的代码风格 ：`stylelint-config-standard`。该风格是 Stylelint 的维护者汲取了 GitHub、Google、Airbnb 多家之长生成的。

**stylelint-order**

> 该插件的作用是强制你按照某个顺序编写 css。例如先写定位，再写盒模型，再写内容区样式，最后写 CSS3 相关属性。这样可以极大的保证我们代码的可读性。

**stylelint-config-recess-order**

> stylelint-order 插件的第三方配置

2. package.json 中的 scripts 里添加

```json
"lint:style": "stylelint --fix \"src/**/*.{vue,css,less,scss}\" --ignore-path .eslintignore",
```

3. 项目根目录添加 .stylelintrc.js 文件

**配置方式：**

1. 在 package.json 中的 stylelint 属性指定规则
2. 在 .stylelintrc 文件中指定，文件格式可以是 JSON 或者 YAML。也可以给该文件加后缀，像这样：.stylelintrc.json, .stylelintrc.yaml, .stylelintrc.yml, .stylelintrc.js
3. stylelint.config.js 文件，该文件 exports 一个配置对象 span>
   > 按顺序查找，以上三种方式任何一项有值，就会结束查找

在项目根目录新建 .stylelintrc.js 文件，复制以下内容

```js
module.exports = {
  root: true,
  extends: [
    'stylelint-config-standard',
    'stylelint-config-recess-order',
    'stylelint-config-prettier',
  ],
  plugins: ['stylelint-scss', 'stylelint-order'],
  rules: {
    'font-family-no-missing-generic-family-keyword': null,
    'selector-type-no-unknown': [
      true,
      {
        ignoreTypes: ['/^page/'],
      },
    ],
    'at-rule-no-unknown': null,
    'unit-no-unknown': [
      true,
      {
        ignoreUnits: ['rpx'],
      },
    ],
    'function-name-case': null,
    'no-descending-specificity': null,
  },
}
```

- at-rule-no-unknown

  [禁止未知的@规则](http://stylelint.docschina.org/user-guide/rules/at-rule-no-unknown/)

  禁掉是为了让 Stylelint 支持 SCSS 语法中的 mixin、extend、content 语法，目前完全关闭

```js
   'at-rule-no-unknown': [
      true,
      { ignoreAtRules: ['mixin', 'extend', 'content', 'include'] },
    ],
```

- No-descending-specificity:

  禁止在具有较高优先级的选择器后出现被其覆盖的较低优先级的选择器。

**片段禁用规则**

```css
/* stylelint-disable */
/* （请说明禁止检测的理由）前端组件限制类名 */
.cropper_topContainer .img-preview {
  border: 0 none;
}
/* stylelint-enable */
```

**fix 方式**

- stylelint --fix

## vscode 配置

1. 安装 ESLint 、stylelint 扩展
2. 工作区配置

在.vscode/settings.json 文件中，追加以下配置项

```json
  "eslint.alwaysShowStatus": true, // 总是在 VSCode 显示 ESLint 的状态
  "eslint.quiet": false, // 显示 warning 的错误
  "editor.codeActionsOnSave": {
    "source.fixAll": true // 保存时使用 eslint/stylelint 修复可修复错误
  }
```

**使用**

ctrl + s 自动修复

## pre-commit

package.json 文件， "lint-staged"添加以下两项，放在 prettier 配置之前

```json
"src/**/*.{js,ts,vue}": "eslint --fix --ignore-path .eslintignore",
"src/**/*.{less,sass,css,vue}": "stylelint --fix --ignore-path .eslintignore",
```
